import org.gradle.internal.jvm.Jvm

apply plugin: 'java'
apply plugin: 'jacoco'
apply plugin: 'propdeps'
apply plugin: 'me.tatarka.retrolambda'
apply plugin: 'com.github.kt3k.coveralls'

sourceCompatibility = 1.8
targetCompatibility = 1.8

task copyTestResources(type: Copy) {
    from sourceSets.test.resources
    into sourceSets.test.output.classesDir
}

processResources.dependsOn copyTestResources

retrolambda {
    exclude 'Test', 'TestReport', 'test', 'testCompile'
    javaVersion JavaVersion.VERSION_1_7
    jdk System.getenv("JAVA_HOME")
    oldJdk System.getenv("JAVA7_HOME")
}

jacocoTestReport {
    reports {
        xml.enabled = true // coveralls plugin depends on xml format report
        html.enabled = true
    }
}

dependencies {
    compile 'com.squareup:javapoet:1.5.1'
    compile 'org.jetbrains:annotations:13.0'

    compileOnly 'com.google.android:android:4.1.1.4'
    compileOnly 'com.google.auto.service:auto-service:1.0-rc2'

    testCompile 'junit:junit:4.12'
    testCompile 'com.google.testing.compile:compile-testing:0.9'
    testCompile 'com.google.truth:truth:0.28'
    testCompile 'org.robolectric:android-all:6.0.0_r1-robolectric-0'
    testCompile files(Jvm.current().getToolsJar())
}